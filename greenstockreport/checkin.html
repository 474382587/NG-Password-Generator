<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>打卡</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
        <script src="main.js"></script>
    </head>

    <body>
        <div class="calendar">
            <div class="title">
                <h2 class="month"></h2>
                <h2 class="year"></h2>
            </div>
            <ul class="dates"></ul>
            <div class="buttons">
                <button id="minus">&lt;</button> <button id="plus">&gt;</button>
            </div>
        </div>
        <style>
            * {
                padding: 0;
                margin: 0;
            }
            .title {
                margin: 0 auto 10px;
                text-align: center;
            }
            ul,
            li {
                list-style: none;
            }
            .buttons {
                text-align: center;
            }
            #minus,
            #plus {
                padding: 10px;
                font-size: 18px;
                font-weight: 600;
                margin: 10px 20px;
            }

            .dates {
                display: flex;
                flex-wrap: wrap;
                justify-content: flex-start;
                max-width: 400px;
                margin: 0 auto;
            }

            .dates > li {
                width: 12%;
                background-color: #e3e3e3;
                padding: 10px 0px;
                box-sizing: border-box;
                border: 1px solid red;
                margin: 4px 1%;
                text-align: center;
            }

            li.active {
                background-color: #123456;
                color: #dddddd;
            }
        </style>
        <script>
            var dates = document.querySelector('.dates')
            var yearField = document.querySelector('.year')
            var monthField = document.querySelector('.month')

            var forward = document.getElementById('plus')
            var backward = document.getElementById('minus')

            var daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
            var currentYear = new Date().getFullYear()
            var currentMonth = new Date().getMonth()
            var currentDate = new Date().getDate()

            forward.addEventListener('click', function() {
                currentYear =
                    currentMonth + 1 > 11 ? currentYear + 1 : currentYear
                currentMonth = (currentMonth + 1) % 12
                console.log(currentYear, currentMonth)
                if (
                    currentYear === new Date().getFullYear() &&
                    currentMonth === new Date().getMonth()
                ) {
                    updateCalendar(currentYear, currentMonth, currentDate)
                } else {
                    updateCalendar(currentYear, currentMonth)
                    updateCalendar(currentYear, currentMonth)
                }
            })
            backward.addEventListener('click', function() {
                currentYear =
                    currentMonth - 1 < 0 ? currentYear - 1 : currentYear
                currentMonth = currentMonth === 0 ? 11 : currentMonth - 1
                console.log(currentYear, currentMonth)
                if (
                    currentYear === new Date().getFullYear() &&
                    currentMonth === new Date().getMonth()
                ) {
                    updateCalendar(currentYear, currentMonth, currentDate)
                } else {
                    updateCalendar(currentYear, currentMonth)
                    updateCalendar(currentYear, currentMonth)
                }
            })

            updateCalendar(currentYear, currentMonth, currentDate)

            document.body.onload = function() {
                var currentDate = new Date().getMonth()
                console.log(currentDate)
            }

            function updateCalendar(year, month, date) {
                dates.innerHTML = ''
                yearField.innerText = year
                monthField.innerText = showMonth(month)
                var list = createDayElement(createDates(year, month), date)
                list.forEach(e => {
                    dates.appendChild(e)
                })
            }

            function createDates(year, month) {
                var totalDays = 0
                var dayStartOfTheMonth = new Date(year, month, 1).getDay()
                if (month === 1) {
                    if (
                        (year % 4 === 0 && year % 100 !== 0) ||
                        year % 400 === 0
                    ) {
                        totalDays = daysInMonth[1] + 1
                    } else {
                        totalDays = daysInMonth[1]
                    }
                } else {
                    totalDays = daysInMonth[month]
                }
                return {
                    totalDays: totalDays,
                    startDay: dayStartOfTheMonth
                }
            }

            function createDayElement(obj, date) {
                var listOfDayElements = []
                for (var i = 0; i < obj.startDay; i++) {
                    listOfDayElements.push(document.createElement('li'))
                }
                for (var j = 0; j < obj.totalDays; j++) {
                    var li = document.createElement('li')
                    if (date && j === date - 1) {
                        li.classList.add('active')
                    }
                    li.innerText = j + 1
                    listOfDayElements.push(li)
                }
                // var blanks = 7 - ((obj.startDay + obj.totalDays) % 7)
                var blanks = (obj.startDay + obj.totalDays) % 7 === 0 ? 0 : 7 - ((obj.startDay + obj.totalDays) % 7)
                for (var i = 0; i < blanks; i++) {
                    listOfDayElements.push(document.createElement('li'))
                }
                return listOfDayElements
            }

            function showMonth(num) {
                switch (num) {
                    case 0:
                        return 'Jan'
                    case 1:
                        return 'Feb'
                    case 2:
                        return 'Mar'
                    case 3:
                        return 'Apr'
                    case 4:
                        return 'May'
                    case 5:
                        return 'Jun'
                    case 6:
                        return 'Jul'
                    case 7:
                        return 'Aug'
                    case 8:
                        return 'Sep'
                    case 9:
                        return 'Oct'
                    case 10:
                        return 'Nov'
                    case 11:
                        return 'Dec'
                }
            }
        </script>
    </body>
</html>
